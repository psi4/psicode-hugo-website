<!-- 
#
# @BEGIN LICENSE
#
# Psi4: an open-source quantum chemistry software package
#
# Copyright (c) 2007-2017 The Psi4 Developers.
#
# The copyrights for code used from other parties are included in
# the corresponding files.
#
# This file is part of Psi4.
#
# Psi4 is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, version 3.
#
# Psi4 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License along
# with Psi4; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
# @END LICENSE
# -->






<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Adding Test Cases</title>
    <link rel="stylesheet" href="_static/psi4.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.base.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="shortcut icon" href="_static/favicon-psi4.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Managing: Git, Conda, CMake and all that" href="manage_index.html" />
    <link rel="prev" title="Linear Algebra in PSI4" href="prog_blas.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="manage_index.html" title="Managing: Git, Conda, CMake and all that"
             accesskey="N"><i class="fa fa-long-arrow-right fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="prog_blas.html" title="Linear Algebra in PSI4"
             accesskey="P"><i class="fa fa-long-arrow-left fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Table Of Contents"
             accesskey="C"><i class="fa fa-book fa-lg"></i></a> &nbsp; &nbsp;</li>
    <li><a href="http://psicode.org/"><i class="fa fa-home fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4"><i class="fa fa-github fa-lg"></i></a></li>
    <li><a href="http://forum.psicode.org"><i class="fa fa-comments-o fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4/edit/master/doc/sphinxman/source/add_tests.rst"><i class="fa fa-pencil fa-lg"></i></a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li><a href="http://github.com/psi4/psi4/tree/406f4de">1.2.1</a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li class="nav-item nav-item-0"><a href="index.html">
        <span style="font-family: Optima, sans-serif;">P<span style="font-size: 82%;">SI</span>4</span>
        </a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>

          <li class="nav-item nav-item-1"><a href="programming.html" accesskey="U">Programming: Using the Core Libraries</a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="adding-test-cases">
<span id="faq-add-tests"></span><h1>Adding Test Cases<a class="headerlink" href="#adding-test-cases" title="Permalink to this headline">¶</a></h1>
<p>To create a new test case, first make a folder in <a class="reference external" href="https://github.com/psi4/psi4/blob/master/tests">psi4/tests</a>. The directory name may not contain an underscore; to indicate spaces, use a hyphen instead. This directory will need two files. The first is <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>, which is necessary to add the test case to the suite. This file should have the following lines:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">(</span><span class="n">TestingMacros</span><span class="p">)</span>

<span class="n">add_regression_test</span><span class="p">(</span><span class="n">directory_name</span> <span class="s2">&quot;psi;semicolon_separated-list-of-applicable-test-labels&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The labels specify which groups of tests include the test case. The <code class="docutils literal notranslate"><span class="pre">psi</span></code> label should always be added, but the other labels are test-specific. The method tested should always be included, and this is often sufficient. If adding a test for an already existing module, the labels for other tests of the module will suggest other labels to add.</p>
<p>A test requiring over 15 minutes should be labeled <code class="docutils literal notranslate"><span class="pre">longtests</span></code>. A short test used for general bug checking should be labeled <code class="docutils literal notranslate"><span class="pre">quicktests</span></code>. A test that confirms <span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span> is operational should be labeled <code class="docutils literal notranslate"><span class="pre">smoketests</span></code>.</p>
<p>The other necessary file is the input file itself, <code class="docutils literal notranslate"><span class="pre">input.dat</span></code>. The input file should be just a simple input file to run the test, with small modifications.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! RI-SCF cc-pVTZ energy of water, with Z-matrix input and cc-pVTZ-RI auxilliary basis.</span>
<span class="c1">#! Also a bit more to force a second line.</span>

<span class="n">nucenergy</span> <span class="o">=</span> <span class="mf">8.801466202085710</span>  <span class="c1">#TEST</span>
<span class="n">refenergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">76.05098402733282</span> <span class="c1">#TEST</span>

<span class="n">molecule</span> <span class="n">h2o</span> <span class="p">{</span>
   <span class="n">symmetry</span> <span class="n">c1</span>
   <span class="n">O</span>
   <span class="n">H</span> <span class="mi">1</span> <span class="mf">1.0</span>
   <span class="n">H</span> <span class="mi">1</span> <span class="mf">1.0</span> <span class="mi">2</span> <span class="mf">104.5</span>
<span class="p">}</span>

<span class="nb">set</span> <span class="p">{</span>
   <span class="n">basis</span> <span class="n">cc</span><span class="o">-</span><span class="n">pVTZ</span>
   <span class="n">scf_type</span> <span class="n">df</span>
   <span class="n">df_basis_scf</span> <span class="n">cc</span><span class="o">-</span><span class="n">pVTZ</span><span class="o">-</span><span class="n">RI</span>
   <span class="n">e_convergence</span> <span class="mi">10</span>
<span class="p">}</span>

<span class="n">thisenergy</span> <span class="o">=</span> <span class="n">energy</span><span class="p">(</span><span class="s1">&#39;rhf&#39;</span><span class="p">)</span>

<span class="n">compare_values</span><span class="p">(</span><span class="n">nucenergy</span><span class="p">,</span> <span class="n">h2o</span><span class="o">.</span><span class="n">nuclear_repulsion_energy</span><span class="p">(),</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;Nuclear repulsion energy&quot;</span><span class="p">)</span> <span class="c1">#TEST</span>
<span class="n">compare_values</span><span class="p">(</span><span class="n">refenergy</span><span class="p">,</span> <span class="n">thisenergy</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;Reference energy&quot;</span><span class="p">)</span> <span class="c1">#TEST</span>
<span class="n">compare_values</span><span class="p">(</span><span class="n">refenergy</span><span class="p">,</span> <span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;scf total energy&#39;</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;Reference energy&quot;</span><span class="p">)</span> <span class="c1">#TEST</span>
</pre></div>
</td></tr></table></div>
<p>Of those small modifications, first, note the special comment at the top (starting with the #! comment marker). This should be very descriptive since it is inlined into the manual (unless !nosample is present in this comment) as a sample input.</p>
<p>The reference values are assigned to variables for later use. The compare_values function (along with several relatives in <a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/driver/p4util/util.py">psi4/psi4/driver/p4util/util.py</a> for comparing strings, matrices, etc.) checks that the computed values match these reference values to suitable precision. This function prints an error message and signals that the test failed to the make system, if the values don’t match. Any lines of the input associated with the validation process should be flagged with #TEST at the end of each line, so that they can be removed when copying from the tests to the samples directory.</p>
<p>Finally, add the directory name to the list of tests in <a class="reference external" href="https://github.com/psi4/psi4/blob/master/tests/CMakeLists.txt">psi4/tests/CMakeLists.txt</a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="index.html" title="index">
          <img class="logo" src="_static/psi4square.png" alt="Logo"/>
        </a></p><!-- 
#
# @BEGIN LICENSE
#
# Psi4: an open-source quantum chemistry software package
#
# Copyright (c) 2007-2017 The Psi4 Developers.
#
# The copyrights for code used from other parties are included in
# the corresponding files.
#
# This file is part of Psi4.
#
# Psi4 is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, version 3.
#
# Psi4 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License along
# with Psi4; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
# @END LICENSE
# -->


<div id="searchbox" style="display: none" role="search">
  <!--<h3>Quick search</h3>-->
    <form class="search" action="search.html" method="get">
      <!--<div><input type="text" name="q" placeholder="search docs" /></div>-->
      <div><input type="text" name="q" placeholder="&#xF002;" style="font-family:FontAwesome, Ariel" /></div>
      <!--<div><input type="submit" value="Go" /></div>-->
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >Index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="manage_index.html" title="Managing: Git, Conda, CMake and all that"
             ><i class="fa fa-long-arrow-right fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="prog_blas.html" title="Linear Algebra in PSI4"
             ><i class="fa fa-long-arrow-left fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Table Of Contents"
             ><i class="fa fa-book fa-lg"></i></a> &nbsp; &nbsp;</li>
    <li><a href="http://psicode.org/"><i class="fa fa-home fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4"><i class="fa fa-github fa-lg"></i></a></li>
    <li><a href="http://forum.psicode.org"><i class="fa fa-comments-o fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4/edit/master/doc/sphinxman/source/add_tests.rst"><i class="fa fa-pencil fa-lg"></i></a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li><a href="http://github.com/psi4/psi4/tree/406f4de">1.2.1</a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li class="nav-item nav-item-0"><a href="index.html">
        <span style="font-family: Optima, sans-serif;">P<span style="font-size: 82%;">SI</span>4</span>
        </a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>

          <li class="nav-item nav-item-1"><a href="programming.html" >Programming: Using the Core Libraries</a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, The Psi4 Project.
      Last updated on Wednesday, 25 July 2018 04:21AM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>